<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>finance-mgn - v1.0.0</title><meta name="description" content="Documentation for finance-mgn"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">finance-mgn - v1.0.0</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>finance-mgn - v1.0.0</h1></div><div class="tsd-panel tsd-typography"><h1 id="finance-management-tool-etl" class="tsd-anchor-link">Finance Management Tool (ETL)<a href="#finance-management-tool-etl" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>A lightweight finance management tool that fetches and processes transaction data, leverages OpenAI to
categorize transactions, and integrates with Google Sheets to store, update, and retrieve financial data.
Additionally, it aggregates transaction data from various sources.</p>
<h2 id="table-of-contents" class="tsd-anchor-link">Table of Contents<a href="#table-of-contents" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><a href="#finance-management-tool-etl">Finance Management Tool (ETL)</a>
<ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#overview">Overview</a>
<ul>
<li><a href="#key-features">Key Features:</a></li>
<li><a href="#key-technical-aspects">Key Technical Aspects:</a></li>
</ul>
</li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#run">Run</a>
<ul>
<li><a href="#supported-flags">Supported Flags</a></li>
<li><a href="#commands">Commands</a></li>
</ul>
</li>
<li><a href="#contribution-guide">Contribution Guide</a>
<ul>
<li><a href="#git-hooks">Git Hooks</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="overview" class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="key-features" class="tsd-anchor-link">Key Features:<a href="#key-features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>External Data Fetching:</strong> Retrieves attachments and transactions from external services (e.g., Air and
FIO).</li>
<li><strong>Data Federation:</strong> Aggregates data from multiple sources.</li>
<li><strong>Transaction Labeling:</strong> Uses OpenAI to generate categories.</li>
<li><strong>Data Integrity:</strong> Validates data after labeling.</li>
<li><strong>Google Sheets Integration:</strong> Reads from, cleans, and writes to Google Sheets.</li>
</ul>
<h3 id="key-technical-aspects" class="tsd-anchor-link">Key Technical Aspects:<a href="#key-technical-aspects" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Cleanup:</strong> If an operation fails, cleanup is performed automatically.</li>
<li><strong>Error Handling:</strong> All errors are propagated to the top level and properly caught and logged.</li>
<li><strong>Testing:</strong> The app is covered by both integration tests and unit tests.</li>
<li><strong>Logging:</strong> Every action is logged to the console.</li>
<li><strong>Developer Experience:</strong> DX is enhanced using Prettier, EditorConfig, and environment variables (<code>.env</code>).</li>
</ul>
<h2 id="configuration" class="tsd-anchor-link">Configuration<a href="#configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Note: As step 4 and 5 are optimal one of them needs to be set -&gt; app cannot work properly without a &quot;data source&quot;.</p>
<ol>
<li>
<p><strong>Install Dependencies</strong></p>
<p>Ensure all necessary packages are installed by running:</p>
<pre><code class="shell"><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">install</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p><strong>Set Up Environment Variables</strong></p>
<p>Rename <code>.env.template</code> to <code>.env</code> in your project root.</p>
</li>
<li>
<p><strong>Google Sheets Integration</strong></p>
<ul>
<li>It is recommended to use two different Google Sheets files: one for development/testing and another for
production.</li>
<li>Google Sheets identifiers must be copied from the URL and set in <a href="media/.env">./.env</a> for <code>GOOGLE_SHEET_ID_PROD</code> and <code>GOOGLE_SHEET_ID_DEV</code> (optional).</li>
<li>Google Sheets sharing settings must be set to &quot;Everyone with the link can edit.&quot;</li>
<li>At <a href="https://docs.google.com/spreadsheets/d/1Izk8IJrqmZxZtTmh4nCfjaUFT2m6Uf_YKNHiCh0ulzI/edit?usp=sharing">this link</a> you can copy generic template with all calculations prepared</li>
<li><strong>Authentication:</strong>
<ul>
<li>A Google Sheets service account must be created, and the credentials file (<code>service-account.json</code>) must
exist in the root folder of this project.</li>
<li>Follow <a href="https://support.google.com/a/answer/7378726?hl=en">this tutorial</a> to create a service account:
<ol>
<li>In Google Cloud, create a new project.</li>
<li>Enable the Google Sheets API.</li>
<li>Under &quot;Credentials,&quot; create a service account.</li>
<li>Generate a JSON key for the account, which will be downloaded automatically.</li>
<li>Place the JSON file in the root folder of this project.</li>
</ol>
</li>
</ul>
</li>
</ul>
<p>Note: Some data sources need to be configured. It can be FIO Bank, AIR Bank, or a custom source (e.g., parsing
transaction PDFs from other banks).</p>
</li>
<li>
<p><strong>FIO Bank (Optional)</strong></p>
<ol>
<li>Go to your internet banking settings -&gt; API.</li>
<li>Add a new token.</li>
<li>Select the requested bank account, set the token validity (maximum of 6 months), mark it as read-only,
and enable the &quot;prolong validity when logged in&quot; option.</li>
<li>Authorize the token creation.</li>
<li>Copy the token value and paste it into your <a href="media/.env">./.env</a> file for <code>FIO_TOKEN</code>.</li>
</ol>
<p>Note: If you need to modify FIO API calls, refer to
<a href="https://www.fio.cz/docs/cz/API_Bankovnictvi.pdf">their documentation</a>.</p>
</li>
<li>
<p><strong>AIR Bank (Optional)</strong></p>
<ul>
<li>Go to your internet banking</li>
<li>Go to Accounts and Cards -&gt; Options -&gt; Setting up statement sending.</li>
<li>Set sending into your mailbox (default mail tight to air bank account) OR you can set different email via &quot;Statement sending for others settings&quot;.</li>
<li>Make sure you picked &quot;monthly&quot; sending.</li>
<li>First email should arrive first day of the next month at 7am CET.</li>
<li>By default email attachment is password protected by phone number tight to air bank account</li>
<li>Add <code>EMAIL_USERNAME</code>, <code>EMAIL_PASSWORD</code>, <code>EMAIL_HOST</code>, <code>AIR_ATTACHMENT_PASSWORD</code> in <a href="media/.env">./.env</a></li>
</ul>
<p>Note: It is not possible to use gmail as it does not support basic authentication. For example you can use email by <a href="http://Seznam.cz">Seznam.cz</a>.</p>
</li>
<li>
<p><strong>OpenAI Integration (Optional)</strong></p>
<ul>
<li>If you want to enable transaction categorization, folow these steps.</li>
</ul>
<ol>
<li>rename the following files and fill in your category
identifiers and descriptions:</li>
</ol>
<ul>
<li><code>./src/static/prompts/expenses.template.txt</code> -&gt; <code>./src/static/prompts/expenses.txt</code></li>
<li><code>./src/static/prompts/incomes.template.txt</code> -&gt; <code>./src/static/prompts/incomes.txt</code>
Register &amp; Sign-in to <a href="https://platform.openai.com">OpenAI developer platform</a></li>
</ul>
<ol start="2">
<li>Go to Settings -&gt; Organization -&gt; Billing</li>
<li>Add credit balance (5USD is enough for more than a year of monthly execution -&gt; depends on used model, price changes, number of transactions, if you will do more frequent tests etc.)</li>
<li>Create new project</li>
<li>Go to API keys</li>
<li>Create new secret key -&gt; owned by you, fill name, assign project, permissions all -&gt; create secret key</li>
<li>Copy the key value and add it to <a href="media/.env">./.env</a> for OPENAI_TOKEN.</li>
</ol>
<p>Note: Default model for development is <code>gpt-4o-mini</code> as is fast and cheap, for production <code>o3-mini</code> is used as it returns good results and reliable output structure</p>
</li>
<li>
<p><strong>Other <code>.env</code> Values</strong></p>
</li>
</ol>
<h2 id="run" class="tsd-anchor-link">Run<a href="#run" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="supported-flags" class="tsd-anchor-link">Supported Flags<a href="#supported-flags" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The application and integration tests support the following flags:</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Shortcut</th>
<th>Values</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>--environment</td>
<td>-e</td>
<td>development, production</td>
<td>development</td>
</tr>
<tr>
<td>--withLabeling</td>
<td>-w</td>
<td>boolean</td>
<td>undefined</td>
</tr>
<tr>
<td>--actions</td>
<td>-a</td>
<td>all, mail, fio</td>
<td>undefined</td>
</tr>
<tr>
<td>--cleanup</td>
<td>-c</td>
<td>all, mail, sheets</td>
<td>undefined</td>
</tr>
</tbody>
</table>
<p>Note: If flags are omitted and <code>.env</code> values are not properly configured, the app will throw an error. In code these flags are called 'app arguments'.</p>
<h3 id="commands" class="tsd-anchor-link">Commands<a href="#commands" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Start commands support flags for configuring the application.</p>
<ul>
<li>
<p>To start the application in development mode, run:</p>
<pre><code class="shell"><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">start</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p>To start the application in production mode, run:</p>
<pre><code class="shell"><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">start:prod</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p>To reset the environment (delete the last month of data in the sheet and mark emails as unread), run:</p>
<pre><code class="shell"><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">cleanup:all</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p>To run integration tests (supports flags described in <a href="#supported-flags">Supported Flags</a>):</p>
<pre><code class="shell"><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">test:integration</span>
</code><button type="button">Copy</button></pre>

<p>Note: Intregration tests also accepts flag <code>--id</code> to run specific test case(s) by id.</p>
<p>Example using id:</p>
<pre><code class="shell"><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">test:integration</span><span class="hl-1"> </span><span class="hl-3">--id</span><span class="hl-1"> </span><span class="hl-4">12</span><span class="hl-1"> </span><span class="hl-4">25</span><span class="hl-1"> </span><span class="hl-4">5</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p>To run unit tests (by default in watch mode), run:</p>
<pre><code class="shell"><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">test:unit</span>
</code><button type="button">Copy</button></pre>

</li>
</ul>
<h2 id="contribution-guide" class="tsd-anchor-link">Contribution Guide<a href="#contribution-guide" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="git-hooks" class="tsd-anchor-link">Git Hooks<a href="#git-hooks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Git hooks are configured by <a href="https://github.com/evilmartians/lefthook">Lefthook</a> in
<a href="media/lefthook.yml">lefthook.yaml</a>.</li>
<li>If hooks are updated / added there is need to run <code>yarn lefthook install</code>.</li>
<li>Repository is using <a href="https://www.conventionalcommits.org/en/v1.0.0/">Conventional Commits</a> and they are
enforced by <code>commitlint</code> in <code>commit-msg</code> hook.</li>
<li>Repository code is formatted by <a href="https://biomejs.dev/">Biome</a> and <a href="media/.editorconfig">.editorconfig</a> in <code>pre-commit</code> hook.</li>
<li>Quality check is done by <a href="https://biomejs.dev/">Biome</a> in <code>pre-commit</code> hook.</li>
</ul>
<p>TODO: Bundling, how to run integration tests, unit tests</p>
<h3 id="imports" class="tsd-anchor-link">imports<a href="#imports" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>imports are using @ for</p>
<h3 id="typedoc" class="tsd-anchor-link">typedoc<a href="#typedoc" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>all objects (methods, contants, type, classes) has to be exported even when they are used within single module, otherwise typedoc won't include it</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#finance-management-tool-etl"><span>Finance <wbr/>Management <wbr/>Tool (ETL)</span></a><ul><li><a href="#table-of-contents"><span>Table of <wbr/>Contents</span></a></li><li><a href="#overview"><span>Overview</span></a></li><li><ul><li><a href="#key-features"><span>Key <wbr/>Features:</span></a></li><li><a href="#key-technical-aspects"><span>Key <wbr/>Technical <wbr/>Aspects:</span></a></li></ul></li><li><a href="#configuration"><span>Configuration</span></a></li><li><a href="#run"><span>Run</span></a></li><li><ul><li><a href="#supported-flags"><span>Supported <wbr/>Flags</span></a></li><li><a href="#commands"><span>Commands</span></a></li></ul></li><li><a href="#contribution-guide"><span>Contribution <wbr/>Guide</span></a></li><li><ul><li><a href="#git-hooks"><span>Git <wbr/>Hooks</span></a></li><li><a href="#imports"><span>imports</span></a></li><li><a href="#typedoc"><span>typedoc</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">finance-mgn - v1.0.0</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
